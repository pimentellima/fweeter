{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext } from \"react\";\nimport { useFieldArray, useForm } from \"react-hook-form\";\nimport { AuthContext } from \"../../contexts/authContext\";\nexport const useWrite = fetchPosts => {\n  _s();\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const {\n    register,\n    unregister,\n    handleSubmit,\n    reset,\n    control,\n    setFocus,\n    formState: {\n      isValid\n    }\n  } = useForm();\n  const {\n    fields: ingredientsArray,\n    append,\n    remove\n  } = useFieldArray({\n    control,\n    name: 'ingredients'\n  });\n  const uploadPostImg = async file => {\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      const res = await axios.post('//localhost:5000/upload/post', formData);\n      return res.data;\n    } catch (err) {\n      console.error(err);\n    }\n  };\n  const onSubmit = async data => {\n    const {\n      title,\n      description,\n      ingredients,\n      file\n    } = data;\n    const fileUrl = file[0] ? await uploadPostImg(file[0]) : '';\n    const postObj = {\n      user_id: currentUser.id,\n      title,\n      description,\n      ingredients: JSON.stringify(ingredients),\n      date: moment().format(\"YYYY-MM-DD HH:mm:ss\"),\n      file: fileUrl\n    };\n    axios.post('//localhost:5000/posts', postObj).then(fetchPosts());\n    reset();\n  };\n  const [description, setDescription] = useState(false);\n  useEffect(() => {\n    if (!description) {\n      unregister('description');\n    } else {\n      setFocus('description');\n    }\n  }, [description]);\n  return {\n    register,\n    onSubmit: handleSubmit(onSubmit),\n    description,\n    setDescription,\n    ingredientsArray,\n    isValid,\n    append,\n    remove\n  };\n};\n_s(useWrite, \"lHtdegPhHIIATzX1dRXx++6yWHk=\", false, function () {\n  return [useForm, useFieldArray];\n});","map":{"version":3,"names":["useContext","useFieldArray","useForm","AuthContext","useWrite","fetchPosts","currentUser","register","unregister","handleSubmit","reset","control","setFocus","formState","isValid","fields","ingredientsArray","append","remove","name","uploadPostImg","file","formData","FormData","res","axios","post","data","err","console","error","onSubmit","title","description","ingredients","fileUrl","postObj","user_id","id","JSON","stringify","date","moment","format","then","setDescription","useState","useEffect"],"sources":["C:/Users/mathe/OneDrive/Documentos/vsc/fwitter/client/src/modules/write/useWrite.js"],"sourcesContent":["import { useContext } from \"react\";\r\nimport { useFieldArray, useForm } from \"react-hook-form\";\r\nimport { AuthContext } from \"../../contexts/authContext\";\r\n\r\nexport const useWrite = (fetchPosts) => {\r\n    const { currentUser } = useContext(AuthContext);\r\n\r\n    const { \r\n        register, \r\n        unregister, \r\n        handleSubmit, \r\n        reset,\r\n        control,\r\n        setFocus,\r\n        formState: { isValid }\r\n    } = useForm();    \r\n\r\n    const { \r\n        fields: ingredientsArray, \r\n        append, \r\n        remove\r\n     } = useFieldArray({\r\n            control,\r\n            name: 'ingredients'\r\n        });\r\n    \r\n    const uploadPostImg = async (file) => {\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append(\"file\", file);\r\n            const res = await axios.post('//localhost:5000/upload/post', formData);\r\n            return res.data;\r\n        } \r\n        catch(err) {\r\n            console.error(err);\r\n        }\r\n    }\r\n        \r\n    const onSubmit = async (data) => {\r\n        const { title, description, ingredients, file } = data;\r\n        const fileUrl = file[0] ? await uploadPostImg(file[0]) : '';\r\n        const postObj = {\r\n            user_id: currentUser.id, \r\n            title,\r\n            description,\r\n            ingredients: JSON.stringify(ingredients),\r\n            date: moment().format(\"YYYY-MM-DD HH:mm:ss\"),\r\n            file: fileUrl\r\n        }\r\n        axios.post('//localhost:5000/posts', postObj)\r\n        .then(fetchPosts());\r\n        reset();\r\n    }\r\n    \r\n    const [description, setDescription] = useState(false)\r\n    \r\n    useEffect(() => {\r\n        if(!description) {\r\n            unregister('description');\r\n        }\r\n        else {\r\n            setFocus('description');\r\n        }\r\n    }, [description])    \r\n\r\n    return { \r\n        register, \r\n        onSubmit: handleSubmit(onSubmit), \r\n        description,\r\n        setDescription, \r\n        ingredientsArray, \r\n        isValid, \r\n        append, \r\n        remove \r\n    }\r\n}"],"mappings":";AAAA,SAASA,UAAU,QAAQ,OAAO;AAClC,SAASC,aAAa,EAAEC,OAAO,QAAQ,iBAAiB;AACxD,SAASC,WAAW,QAAQ,4BAA4B;AAExD,OAAO,MAAMC,QAAQ,GAAIC,UAAU,IAAK;EAAA;EACpC,MAAM;IAAEC;EAAY,CAAC,GAAGN,UAAU,CAACG,WAAW,CAAC;EAE/C,MAAM;IACFI,QAAQ;IACRC,UAAU;IACVC,YAAY;IACZC,KAAK;IACLC,OAAO;IACPC,QAAQ;IACRC,SAAS,EAAE;MAAEC;IAAQ;EACzB,CAAC,GAAGZ,OAAO,EAAE;EAEb,MAAM;IACFa,MAAM,EAAEC,gBAAgB;IACxBC,MAAM;IACNC;EACH,CAAC,GAAGjB,aAAa,CAAC;IACXU,OAAO;IACPQ,IAAI,EAAE;EACV,CAAC,CAAC;EAEN,MAAMC,aAAa,GAAG,MAAOC,IAAI,IAAK;IAClC,IAAI;MACA,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,EAAE;MAC/BD,QAAQ,CAACL,MAAM,CAAC,MAAM,EAAEI,IAAI,CAAC;MAC7B,MAAMG,GAAG,GAAG,MAAMC,KAAK,CAACC,IAAI,CAAC,8BAA8B,EAAEJ,QAAQ,CAAC;MACtE,OAAOE,GAAG,CAACG,IAAI;IACnB,CAAC,CACD,OAAMC,GAAG,EAAE;MACPC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;IACtB;EACJ,CAAC;EAED,MAAMG,QAAQ,GAAG,MAAOJ,IAAI,IAAK;IAC7B,MAAM;MAAEK,KAAK;MAAEC,WAAW;MAAEC,WAAW;MAAEb;IAAK,CAAC,GAAGM,IAAI;IACtD,MAAMQ,OAAO,GAAGd,IAAI,CAAC,CAAC,CAAC,GAAG,MAAMD,aAAa,CAACC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE;IAC3D,MAAMe,OAAO,GAAG;MACZC,OAAO,EAAE/B,WAAW,CAACgC,EAAE;MACvBN,KAAK;MACLC,WAAW;MACXC,WAAW,EAAEK,IAAI,CAACC,SAAS,CAACN,WAAW,CAAC;MACxCO,IAAI,EAAEC,MAAM,EAAE,CAACC,MAAM,CAAC,qBAAqB,CAAC;MAC5CtB,IAAI,EAAEc;IACV,CAAC;IACDV,KAAK,CAACC,IAAI,CAAC,wBAAwB,EAAEU,OAAO,CAAC,CAC5CQ,IAAI,CAACvC,UAAU,EAAE,CAAC;IACnBK,KAAK,EAAE;EACX,CAAC;EAED,MAAM,CAACuB,WAAW,EAAEY,cAAc,CAAC,GAAGC,QAAQ,CAAC,KAAK,CAAC;EAErDC,SAAS,CAAC,MAAM;IACZ,IAAG,CAACd,WAAW,EAAE;MACbzB,UAAU,CAAC,aAAa,CAAC;IAC7B,CAAC,MACI;MACDI,QAAQ,CAAC,aAAa,CAAC;IAC3B;EACJ,CAAC,EAAE,CAACqB,WAAW,CAAC,CAAC;EAEjB,OAAO;IACH1B,QAAQ;IACRwB,QAAQ,EAAEtB,YAAY,CAACsB,QAAQ,CAAC;IAChCE,WAAW;IACXY,cAAc;IACd7B,gBAAgB;IAChBF,OAAO;IACPG,MAAM;IACNC;EACJ,CAAC;AACL,CAAC;AAAA,GAvEYd,QAAQ;EAAA,QAWbF,OAAO,EAMND,aAAa;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}